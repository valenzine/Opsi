<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<title>Opsi</title>
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" type="text/css" media="screen" />
		<link rel="stylesheet" href="css/style.css" type="text/css" media="screen" />
		<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
		<script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
		<script type="text/javascript" src="src/jquery.opsi.js"></script>
		<script src="phonegap.js"></script>
	</head>
	<body>
		<div class="machineContainer" id="face">
			<div>
				<div id="eyes" class="slotMachine">
					<div class="slot eyes slot1"></div>
					<div class="slot eyes slot2"></div>
					<div class="slot eyes slot3"></div>
					<div class="slot eyes slot4"></div>
					<div class="slot eyes slot5"></div>
					<div class="slot eyes slot6"></div>
					<div class="slot eyes slot7"></div>
					<div class="slot eyes slot8"></div>
					<div class="slot eyes slot9"></div>
					<div class="slot eyes slot10"></div>
					<div class="slot eyes slot11"></div>
					<div class="slot eyes slot12"></div>
					<div class="slot eyes slot13"></div>
					<div class="slot eyes slot14"></div>
					<div class="slot eyes slot15"></div>
					<div class="slot eyes slot16"></div>
					<div class="slot eyes slot17"></div>
					<div class="slot eyes slot18"></div>
					<div class="slot eyes slot19"></div>
					<div class="slot eyes slot20"></div>
					<div class="slot eyes slot21"></div>
					<div class="slot eyes slot22"></div>
					<div class="slot eyes slot23"></div>
					<div class="slot eyes slot24"></div>
					<div class="slot eyes slot25"></div>
					<div class="slot eyes slot26"></div>
					<div class="slot eyes slot27"></div>
					<div class="slot eyes slot28"></div>
					<div class="slot eyes slot29"></div>
					<div class="slot eyes slot30"></div>
					<div class="slot eyes slot31"></div>
					<div class="slot eyes slot32"></div>
					<div class="slot eyes slot33"></div>
					<div class="slot eyes slot34"></div>
					<div class="slot eyes slot35"></div>
					<div class="slot eyes slot36"></div>
					<div class="slot eyes slot37"></div>
					<div class="slot eyes slot38"></div>
					<div class="slot eyes slot39"></div>
					<div class="slot eyes slot40"></div>
					<div class="slot eyes slot41"></div>
					<div class="slot eyes slot42"></div>
					<div class="slot eyes slot43"></div>
					<div class="slot eyes slot44"></div>
					<div class="slot eyes slot45"></div>
					<div class="slot eyes slot46"></div>
					<div class="slot eyes slot47"></div>
					<div class="slot eyes slot48"></div>
					<div class="slot eyes slot49"></div>
					<div class="slot eyes slot50"></div>
					<div class="slot eyes slot51"></div>
					<div class="slot eyes slot52"></div>
					<div class="slot eyes slot53"></div>
					<div class="slot eyes slot54"></div>
					<div class="slot eyes slot55"></div>
				</div>

				<div id="noses" class="slotMachine">
					<div class="slot noses slot1"></div>
					<div class="slot noses slot2"></div>
					<div class="slot noses slot3"></div>
					<div class="slot noses slot4"></div>
					<div class="slot noses slot5"></div>
					<div class="slot noses slot6"></div>
					<div class="slot noses slot7"></div>
					<div class="slot noses slot8"></div>
					<div class="slot noses slot9"></div>
					<div class="slot noses slot10"></div>
					<div class="slot noses slot11"></div>
				</div>

				<div id="mouths" class="slotMachine">
					<div class="slot mouths slot1 "></div>
					<div class="slot mouths slot2 "></div>
					<div class="slot mouths slot3 "></div>
					<div class="slot mouths slot4 "></div>
					<div class="slot mouths slot5 "></div>
					<div class="slot mouths slot6 "></div>
					<div class="slot mouths slot7 "></div>
					<div class="slot mouths slot8 "></div>
					<div class="slot mouths slot9 "></div>
					<div class="slot mouths slot10"></div>
					<div class="slot mouths slot11"></div>
					<div class="slot mouths slot12"></div>
					<div class="slot mouths slot13"></div>
					<div class="slot mouths slot14"></div>
					<div class="slot mouths slot15"></div>
					<div class="slot mouths slot16"></div>
					<div class="slot mouths slot17"></div>
					<div class="slot mouths slot18"></div>
					<div class="slot mouths slot19"></div>
					<div class="slot mouths slot20"></div>
					<div class="slot mouths slot21"></div>
					<div class="slot mouths slot22"></div>
					<div class="slot mouths slot23"></div>
					<div class="slot mouths slot24"></div>
					<div class="slot mouths slot25"></div>
					<div class="slot mouths slot26"></div>
					<div class="slot mouths slot27"></div>
					<div class="slot mouths slot28"></div>
					<div class="slot mouths slot29"></div>
					<div class="slot mouths slot30"></div>
					<div class="slot mouths slot31"></div>
					<div class="slot mouths slot32"></div>
					<div class="slot mouths slot33"></div>
					<div class="slot mouths slot34"></div>
					<div class="slot mouths slot35"></div>
					<div class="slot mouths slot36"></div>
				</div>
			</div>
		</div>			
		<div id="screenshot"></div>

		<script>
			$(document).ready(function(){

				var images = [
					"img/eyes_743d60.png","img/eyes_426a73.png","img/eyes_7c734f.png","img/eyes_2d3b72.png","img/eyes_378061.png","img/eyes_512e88.png","img/eyes_c826b0.png","img/eyes_dee9bd.png","img/eyes_f6ca44.png","img/mouths_743d60.png","img/mouths_426a73.png","img/mouths_7c734f.png","img/mouths_2d3b72.png","img/mouths_378061.png","img/mouths_512e88.png","img/mouths_c826b0.png","img/mouths_dee9bd.png","img/mouths_f6ca44.png","img/noses_743d60.png","img/noses_426a73.png","img/noses_7c734f.png","img/noses_2d3b72.png","img/noses_378061.png","img/noses_512e88.png","img/noses_c826b0.png","img/noses_dee9bd.png","img/noses_f6ca44.png"
				];
				
				$.preload(images);
		
				//create a new instance of shake.js.
				var myShakeEvent = new Shake({
					threshold: 15
				});

				// start listening to device motion
				myShakeEvent.start();

				// register a shake event
				window.addEventListener('shake', shakeEventDidOccur, false);

				//shake event callback
				function shakeEventDidOccur () {
					opsi();
				}
				
				var machine1 = $("#eyes").slotMachine({
					active	: 0,
					delay	: 0
				});
				
				var machine2 = $("#noses").slotMachine({
					active	: 1,
					delay	: 0
				});
				
				var machine3 = $("#mouths").slotMachine({
					active	: 2,
					delay	: 0
				});
				
				var colors = ["743d60","426a73","7c734f","2d3b72","378061","512e88","c826b0","dee9bd","f6ca44"],
					color = colors[Math.floor(colors.length * Math.random())];
					
				function switchColors(){
					color = colors[Math.floor(colors.length * Math.random())];
				}
				
				function onComplete(active){
				
					switch(this.element[0].id){
						case 'eyes':
							var activo1 = this.active + 1;
							$(".eyes.slot"+activo1).removeClass().addClass('eyes slot'+activo1+' c'+color);
							break;
						case 'noses':
							var activo2 = this.active + 1;
							$(".noses.slot"+activo2).removeClass().addClass('noses slot'+activo2+' c'+color);
							break;
						case 'mouths':
							var activo3 = this.active + 1;
							$(".mouths.slot"+activo3).removeClass().addClass('mouths slot'+activo3+' c'+color);
							break;
					}
				}
				
				$("#face").click(function(){
					opsi();
				});	
				
				$("#screenshot").click(function(){
					navigator.screenshot.save(function(error,res){
						if(error){
							console.error(error);
						}else{
							console.log('ok',res.filePath);
						}
					});
					alert('Screenshot taken!');
				});
				
				function opsi() {
					switchColors();
					machine1.shuffle(1, onComplete);
					machine2.shuffle(1, onComplete);
					machine3.shuffle(1, onComplete);
				};
				
			});
		</script>	

	</body>
</html>